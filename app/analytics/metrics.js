import {maxDrawdown} from './risk.js';
export function computeMetrics(data){const pnlClosed=data.trades.map(t=>t.pnl||0);const pnlCum=pnlClosed.reduce((a,v)=>{a.push((a.at(-1)||0)+v);return a;},[]);const dd=maxDrawdown(pnlCum);const wins=data.trades.filter(t=>(t.pnl||0)>0).length;const losses=data.trades.filter(t=>(t.pnl||0)<0).length;const sumPos=data.trades.reduce((s,t)=>s+Math.max(0,t.pnl||0),0);const sumNeg=data.trades.reduce((s,t)=>s+Math.min(0,t.pnl||0),0);return{trades:data.trades.length,winrate:(wins/Math.max(1,wins+losses))*100,profitFactor:sumPos/Math.max(1,Math.abs(sumNeg)),maxDrawdown:dd,fees:{commission:data.account.commission??0,overnight:data.account.overnight??0,fx:data.account.fx_fees??0},dividends:data.account.dividends??0,realizedEquityEnd:data.account.realized_end??null};}